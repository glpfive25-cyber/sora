# 前端自定义 API 配置说明

## ✅ 已完成的改进

现在**角色创建**和**角色视频生成**功能都支持使用前端的自定义 API 配置了！

## 🎯 使用方法

### 方式 1: 使用前端设置（推荐）

1. **打开设置**
   - 点击页面右上角的"设置"按钮（⚙️图标）

2. **配置 API**
   - **API Key**: 输入你的 API Key
   - **Base URL**: 输入 API 地址
   
   例如：
   ```
   API Key: sk-你的完整API_Key
   Base URL: https://apipro.maynor1024.live/
   ```

3. **保存设置**
   - 点击"保存设置"按钮
   - 看到"设置已保存"提示

4. **开始使用**
   - 无需重启服务器
   - 立即生效
   - 所有功能都会使用你配置的 API

### 方式 2: 使用服务器配置

编辑 `.env` 文件（需要重启服务器）：
```env
SORA_API_KEY=你的API_Key
SORA_BASE_URL=https://apipro.maynor1024.live/
```

## 🔄 工作原理

### 优先级

1. **前端自定义配置** > **服务器配置**
2. 如果前端设置了 API Key 和 Base URL，使用前端配置
3. 否则，使用服务器的 `.env` 配置

### 功能支持

| 功能 | 前端配置 | 服务器配置 |
|-----|---------|-----------|
| 视频生成 | ✅ | ✅ |
| 图像生成 | ✅ | ✅ |
| 角色创建 | ✅ | ✅ |
| 角色视频 | ✅ | ✅ |

## 📝 配置示例

### 配置 1: 使用支持角色的 API

```
API Key: sk-你的API_Key
Base URL: https://apipro.maynor1024.live/
```

**支持的功能**:
- ✅ 视频生成
- ✅ 图像生成
- ✅ 角色创建
- ✅ 角色视频生成

### 配置 2: 使用基础 API

```
API Key: sk-你的API_Key
Base URL: https://api.nextaicore.com/
```

**支持的功能**:
- ✅ 视频生成
- ✅ 图像生成
- ❌ 角色创建（不支持）
- ❌ 角色视频生成（不支持）

## 🔍 如何检查当前配置

### 方法 1: 查看浏览器控制台

打开浏览器开发者工具（F12），查看日志：

**使用前端配置时**:
```
[CHARACTER] Using custom API: https://apipro.maynor1024.live/
```

**使用服务器配置时**:
```
[CHARACTER] Using local server proxy
```

### 方法 2: 查看设置界面

1. 点击"设置"按钮
2. 查看 API Key 和 Base URL 字段
3. 如果有值，说明使用前端配置

## 💡 优势

### 使用前端配置的好处

1. **无需重启服务器**
   - 修改配置立即生效
   - 快速切换不同的 API

2. **多用户支持**
   - 每个用户可以使用自己的 API Key
   - 配置保存在浏览器本地

3. **灵活切换**
   - 可以快速测试不同的 API 提供商
   - 可以在不同的 API 之间切换

4. **隐私保护**
   - API Key 只保存在你的浏览器中
   - 不会暴露给服务器

## 🔧 故障排除

### 问题 1: 设置不生效

**解决方案**:
1. 确保 API Key 和 Base URL 都已填写
2. Base URL 末尾要有斜杠 `/`
3. 点击"保存设置"按钮
4. 刷新页面

### 问题 2: 角色创建失败

**检查**:
1. 你的 API 是否支持角色功能？
2. API Key 是否有效？
3. Base URL 是否正确？

**测试**:
```bash
curl -X POST "你的Base_URL/sora/v1/characters" \
  -H "Authorization: Bearer 你的API_Key" \
  -H "Content-Type: application/json" \
  -d '{"url": "https://test.com/video.mp4", "timestamps": "1,3"}'
```

### 问题 3: 想恢复默认设置

1. 点击"设置"按钮
2. 点击"恢复默认"按钮
3. 确认操作

或者清除浏览器 localStorage：
```javascript
// 在浏览器控制台执行
localStorage.removeItem('sora2-api-config');
```

## 📊 配置对比

### 前端配置 vs 服务器配置

| 特性 | 前端配置 | 服务器配置 |
|-----|---------|-----------|
| 修改后生效 | 立即 | 需重启 |
| 多用户支持 | ✅ | ❌ |
| 配置位置 | 浏览器 localStorage | .env 文件 |
| 隐私性 | 高 | 中 |
| 便捷性 | 高 | 中 |

## 🎯 推荐配置流程

### 新用户

1. **首次使用**
   - 点击"设置"按钮
   - 输入 API Key 和 Base URL
   - 保存设置

2. **测试功能**
   - 先测试视频生成
   - 再测试角色创建
   - 确认一切正常

3. **开始使用**
   - 享受完整功能

### 开发者

1. **开发环境**
   - 使用 `.env` 文件配置
   - 方便团队共享配置

2. **生产环境**
   - 让用户使用前端配置
   - 每个用户使用自己的 API Key

## 🔐 安全提示

1. **不要分享 API Key**
   - API Key 是你的私密信息
   - 不要在公共场合展示

2. **定期更换 API Key**
   - 如果怀疑泄露，立即更换
   - 在 API 提供商网站重新生成

3. **使用环境变量**
   - 开发时使用 `.env` 文件
   - 不要将 `.env` 提交到 Git

## 📞 获取帮助

如果遇到问题：

1. **查看浏览器控制台**
   - 按 F12 打开开发者工具
   - 查看 Console 标签的错误信息

2. **查看服务器日志**
   - 查看运行 `npm start` 的终端输出

3. **运行诊断脚本**
   ```bash
   npm run test:api
   ```

---

**现在你可以直接在前端设置中配置 API，无需修改 .env 文件或重启服务器！**
