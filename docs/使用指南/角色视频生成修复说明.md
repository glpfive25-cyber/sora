# è§’è‰²è§†é¢‘ç”Ÿæˆ "Invalid URL" é”™è¯¯ä¿®å¤

## ğŸ” é—®é¢˜æè¿°

é”™è¯¯ä¿¡æ¯ï¼š
```
Video with character creation error: Invalid URL (POST /v1/video/create)
```

## ğŸ¯ é—®é¢˜åŸå› 

ä»£ç ä½¿ç”¨äº†é”™è¯¯çš„ API ç«¯ç‚¹ã€‚æ ¹æ® API æ–‡æ¡£ï¼š

- âŒ **é”™è¯¯**: ä½¿ç”¨ `/v1/video/create` ç«¯ç‚¹
- âœ… **æ­£ç¡®**: åº”è¯¥ä½¿ç”¨ `/v1/chat/completions` ç«¯ç‚¹ï¼ˆChat API æ ¼å¼ï¼‰

å¸¦è§’è‰²çš„è§†é¢‘ç”Ÿæˆåº”è¯¥ä½¿ç”¨ **Chat API æ ¼å¼**ï¼Œå¹¶åœ¨æç¤ºè¯ä¸­åŒ…å« `@username`ã€‚

## âœ… å·²ä¿®å¤

### 1. ä¿®æ”¹äº† API ç«¯ç‚¹

**ä¹‹å‰**:
```javascript
const response = await this.client.post('/v1/video/create', requestData);
```

**ç°åœ¨**:
```javascript
const response = await this.client.post('/v1/chat/completions', requestData);
```

### 2. ä½¿ç”¨ Chat API æ ¼å¼

**ä¹‹å‰**:
```javascript
{
  model: 'sora-2',
  prompt: 'è·³ä¸ªèˆ',
  character_url: 'https://...',
  character_timestamps: '1,3'
}
```

**ç°åœ¨**:
```javascript
{
  model: 'sora-2-characters',
  messages: [
    {
      role: 'user',
      content: [
        {
          type: 'text',
          text: '@username è·³ä¸ªèˆ'
        }
      ]
    }
  ]
}
```

### 3. è‡ªåŠ¨æå–ä»»åŠ¡ ID

Chat API è¿”å›çš„æ ¼å¼ä¸åŒï¼Œç°åœ¨ä¼šè‡ªåŠ¨ä»å“åº”ä¸­æå–ä»»åŠ¡ IDï¼š

```javascript
// ä»å“åº”å†…å®¹ä¸­æå–: task_01k900ag82ecgbewj2xa3758z0
const taskIdMatch = content.match(/task_[a-z0-9]+/i);
```

## ğŸ“ ä½¿ç”¨æ–¹æ³•

### æ–¹å¼ 1: åœ¨æç¤ºè¯ä¸­ä½¿ç”¨ @usernameï¼ˆæ¨èï¼‰

```javascript
// å‰ç«¯
const prompt = '@lahdevqrp.skybounddu è·³ä¸ªèˆ';

// è¿™ä¼šè‡ªåŠ¨è¢«è¯†åˆ«å¹¶ä½¿ç”¨è¯¥è§’è‰²
```

### æ–¹å¼ 2: ä»ä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©è§’è‰²

1. å…ˆåˆ›å»ºè§’è‰²ï¼ˆä¸Šä¼ è§†é¢‘å¹¶è®¾ç½®æ—¶é—´æˆ³ï¼‰
2. åœ¨"è§’è‰²è§†é¢‘ç”Ÿæˆ"æ ‡ç­¾ä¸­é€‰æ‹©è§’è‰²
3. è¾“å…¥æç¤ºè¯ï¼ˆä¼šè‡ªåŠ¨æ·»åŠ  @usernameï¼‰

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æ­¥éª¤ 1: é‡å¯æœåŠ¡å™¨

```bash
# åœæ­¢å½“å‰æœåŠ¡å™¨ï¼ˆCtrl+Cï¼‰
npm start
```

### æ­¥éª¤ 2: åˆ›å»ºè§’è‰²

1. æ‰“å¼€æµè§ˆå™¨ http://localhost:3000
2. åˆ‡æ¢åˆ°"è§’è‰²ç®¡ç†"æ ‡ç­¾
3. ä¸Šä¼ è§†é¢‘æˆ–ä½¿ç”¨é»˜è®¤è§†é¢‘
4. è®¾ç½®æ—¶é—´æˆ³ï¼ˆä¾‹å¦‚ 1-3 ç§’ï¼‰
5. ç‚¹å‡»"åˆ›å»ºè§’è‰²"
6. è®°ä¸‹è§’è‰²ç”¨æˆ·åï¼ˆä¾‹å¦‚ï¼š`lahdevqrp.skybounddu`ï¼‰

### æ­¥éª¤ 3: ç”Ÿæˆè§’è‰²è§†é¢‘

1. åˆ‡æ¢åˆ°"è§’è‰²è§†é¢‘ç”Ÿæˆ"æ ‡ç­¾
2. è¾“å…¥æç¤ºè¯ï¼ŒåŒ…å« @usernameï¼š
   ```
   @lahdevqrp.skybounddu è·³ä¸ªèˆ
   ```
3. é€‰æ‹©æ¨¡å‹ï¼ˆæ¨è `sora-2-characters`ï¼‰
4. ç‚¹å‡»"ç”Ÿæˆè§†é¢‘"

### æ­¥éª¤ 4: æŸ¥çœ‹è¿›åº¦

- ç³»ç»Ÿä¼šæ˜¾ç¤ºä»»åŠ¡ ID
- è‡ªåŠ¨è½®è¯¢ä»»åŠ¡çŠ¶æ€
- å®Œæˆåæ˜¾ç¤ºè§†é¢‘

## ğŸ”§ æ¨¡å‹é€‰æ‹©

æ ¹æ® API æ–‡æ¡£ï¼Œä½¿ç”¨è§’è‰²åŠŸèƒ½æ—¶åº”è¯¥é€‰æ‹©ï¼š

- âœ… `sora-2-characters` - ä¸“é—¨ç”¨äºè§’è‰²è§†é¢‘
- âœ… `sora-2` - ä¹Ÿæ”¯æŒè§’è‰²ï¼ˆé€šè¿‡ @usernameï¼‰
- âœ… `sora-2-pro` - é«˜çº§ç‰ˆæœ¬ï¼Œæ”¯æŒæ›´é•¿æ—¶é—´

## ğŸ“Š API å“åº”æ ¼å¼

### Chat API å“åº”ç¤ºä¾‹

```json
{
  "id": "chatcmpl-xxxxx",
  "object": "chat.completion",
  "created": 1760338775,
  "model": "sora-2",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "```json\n{\n  \"prompt\": \"@username è·³ä¸ªèˆ\",\n  \"orientation\": \"portrait\"\n}\n```\n\n> ID: `task_01k900ag82ecgbewj2xa3758z0`\n..."
      },
      "finish_reason": "stop"
    }
  ]
}
```

### æå–çš„ä»»åŠ¡ä¿¡æ¯

```javascript
{
  id: 'task_01k900ag82ecgbewj2xa3758z0',
  status: 'pending',
  content: 'å®Œæ•´çš„å“åº”å†…å®¹...',
  raw_response: { /* åŸå§‹å“åº” */ }
}
```

## ğŸ› è°ƒè¯•ä¿¡æ¯

ç°åœ¨ä¼šåœ¨æ§åˆ¶å°æ˜¾ç¤ºè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼š

```
[Sora2] Creating video with character, model: sora-2-characters
[Sora2] Using Chat API format for character video
[Sora2] Added character username to prompt: lahdevqrp.skybounddu
[Sora2] Using model: sora-2-characters
[Sora2] Prompt: @lahdevqrp.skybounddu è·³ä¸ªèˆ
[Sora2] Video with character request data: {...}
[Sora2] Video with character creation response: {...}
[Sora2] Response content: ...
[Sora2] Extracted task ID: task_xxxxx
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. è§’è‰²ç”¨æˆ·åæ ¼å¼

- å¿…é¡»ä»¥ `@` å¼€å¤´
- å¯ä»¥åŒ…å«å­—æ¯ã€æ•°å­—ã€ç‚¹å·
- ä¾‹å¦‚ï¼š`@lahdevqrp.skybounddu`

### 2. æ¨¡å‹é€‰æ‹©

- ä½¿ç”¨è§’è‰²åŠŸèƒ½æ—¶ï¼Œæ¨èé€‰æ‹© `sora-2-characters`
- å¦‚æœè¯¥æ¨¡å‹ä¸å¯ç”¨ï¼Œä½¿ç”¨ `sora-2` ä¹Ÿå¯ä»¥

### 3. è§†é¢‘è¦æ±‚

- åˆ›å»ºè§’è‰²çš„è§†é¢‘ä¸­ä¸èƒ½å‡ºç°çœŸäºº
- æ—¶é—´æˆ³èŒƒå›´ï¼š1-3 ç§’
- è§†é¢‘å¿…é¡»æ¸…æ™°å¯è§è§’è‰²

### 4. æç¤ºè¯æ ¼å¼

```
@username åŠ¨ä½œæè¿°
```

ä¾‹å¦‚ï¼š
- `@sama è·³ä¸ªèˆ`
- `@character åœ¨æ£®æ—é‡Œå¥”è·‘`
- `@mychar æŒ¥æ‰‹æ‰“æ‹›å‘¼`

## ğŸ”„ å…¼å®¹æ€§

ä»£ç ä¿ç•™äº†æ—§çš„ `character_url` å’Œ `character_timestamps` æ–¹å¼ä»¥ä¿æŒå…¼å®¹æ€§ï¼Œä½†æ¨èä½¿ç”¨æ–°çš„ `@username` æ–¹å¼ã€‚

## ğŸ“ å¦‚æœä»ç„¶å‡ºé”™

### æ£€æŸ¥æ¸…å•

- [ ] æœåŠ¡å™¨å·²é‡å¯
- [ ] è§’è‰²å·²æˆåŠŸåˆ›å»º
- [ ] æç¤ºè¯åŒ…å«æ­£ç¡®çš„ @username
- [ ] é€‰æ‹©äº†æ­£ç¡®çš„æ¨¡å‹
- [ ] API Key æœ‰æ•ˆä¸”æœ‰ä½™é¢

### æŸ¥çœ‹æ—¥å¿—

1. **æµè§ˆå™¨æ§åˆ¶å°**ï¼ˆF12ï¼‰
   - æŸ¥æ‰¾ `[CHARACTER]` å¼€å¤´çš„æ—¥å¿—
   - æŸ¥æ‰¾ `[Sora2]` å¼€å¤´çš„æ—¥å¿—

2. **æœåŠ¡å™¨ç»ˆç«¯**
   - æŸ¥æ‰¾ `[Server]` å¼€å¤´çš„æ—¥å¿—
   - æŸ¥æ‰¾é”™è¯¯å †æ ˆä¿¡æ¯

### è¿è¡Œè¯Šæ–­

```bash
# æµ‹è¯• API è¿æ¥
npm run test:api

# æµ‹è¯•è§’è‰²åˆ›å»º
npm run test:character
```

## ğŸ’¡ ç¤ºä¾‹ä»£ç 

### å®Œæ•´çš„è§’è‰²è§†é¢‘ç”Ÿæˆæµç¨‹

```javascript
// 1. åˆ›å»ºè§’è‰²
const characterResponse = await fetch('/api/character/create', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    videoUrl: 'https://...',
    timestamps: '1,3'
  })
});
const character = await characterResponse.json();
console.log('è§’è‰²ç”¨æˆ·å:', character.username);

// 2. ç”Ÿæˆè§’è‰²è§†é¢‘
const videoResponse = await fetch('/api/video/create-with-character', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    prompt: `@${character.username} è·³ä¸ªèˆ`,
    model: 'sora-2-characters',
    size: 'large',
    duration: 10,
    orientation: 'portrait',
    images: []
  })
});
const video = await videoResponse.json();
console.log('ä»»åŠ¡ ID:', video.id);

// 3. è½®è¯¢ä»»åŠ¡çŠ¶æ€
const checkStatus = async (taskId) => {
  const statusResponse = await fetch(`/api/videos/${taskId}`);
  const status = await statusResponse.json();
  console.log('çŠ¶æ€:', status.status);
  return status;
};
```

---

**ä¿®å¤å®Œæˆï¼ç°åœ¨åº”è¯¥å¯ä»¥æ­£å¸¸ç”Ÿæˆå¸¦è§’è‰²çš„è§†é¢‘äº†ã€‚**
