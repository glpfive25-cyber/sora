# 500 错误诊断指南

## 🔍 当前错误

```
POST https://apipro.maynor1024.live/sora/v1/characters 500 (Internal Server Error)
```

## 🎯 问题分析

500 错误表示**服务器内部错误**。可能的原因：

### 1. API Key 问题（最常见）

- ❌ API Key 无效或已过期
- ❌ API Key 不完整（被截断）
- ❌ API Key 没有访问该功能的权限
- ❌ API Key 余额不足

### 2. 请求参数问题

- ❌ 视频 URL 格式不正确
- ❌ 时间戳格式不正确
- ❌ 视频 URL 无法访问
- ❌ 视频包含真人（不允许）

### 3. API 服务问题

- ❌ API 服务暂时故障
- ❌ API 服务过载
- ❌ API 配置错误

## ✅ 诊断步骤

### 步骤 1: 检查浏览器控制台

打开浏览器开发者工具（F12），查看完整的错误信息：

```javascript
[CHARACTER] API Response: {
  status: 500,
  ok: false,
  data: { ... },
  dataString: "..." // 这里会显示完整的错误信息
}
```

**查找关键信息**：
- `error.message` - 错误描述
- `error.code` - 错误代码
- `error.type` - 错误类型

### 步骤 2: 检查 API Key

1. **确认 API Key 完整**
   - 打开设置（⚙️图标）
   - 查看 API Key 字段
   - 确保没有被截断
   - 通常是 50+ 个字符

2. **测试 API Key**
   ```bash
   curl -X GET "https://apipro.maynor1024.live/v1/models" \
     -H "Authorization: Bearer 你的API_Key"
   ```

   **预期结果**：
   - ✅ 返回模型列表 → API Key 有效
   - ❌ 返回 401 错误 → API Key 无效

### 步骤 3: 检查请求参数

查看浏览器控制台的请求数据：

```javascript
{
  url: "https://filesystem.site/cdn/20251030/javYrU4etHVFDqg8by7mViTWHlMOZy.mp4",
  timestamps: "1,3"
}
```

**检查清单**：
- [ ] URL 是否可访问？
- [ ] 时间戳格式是否正确？（例如 "1,3"）
- [ ] 时间戳范围是否在 1-3 秒之间？

### 步骤 4: 测试视频 URL

```bash
# 测试视频是否可访问
curl -I "https://filesystem.site/cdn/20251030/javYrU4etHVFDqg8by7mViTWHlMOZy.mp4"
```

**预期结果**：
- ✅ 返回 200 OK → 视频可访问
- ❌ 返回 404 → 视频不存在

### 步骤 5: 直接测试 API

```bash
curl -X POST "https://apipro.maynor1024.live/sora/v1/characters" \
  -H "Authorization: Bearer 你的API_Key" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://filesystem.site/cdn/20251030/javYrU4etHVFDqg8by7mViTWHlMOZy.mp4",
    "timestamps": "1,3"
  }'
```

**查看响应**：
- 如果返回详细的错误信息，说明问题所在
- 如果返回 500，可能是 API 服务问题

## 🛠️ 常见错误及解决方案

### 错误 1: "Invalid API Key"

**原因**: API Key 无效或已过期

**解决方案**:
1. 登录 API 提供商网站
2. 重新生成 API Key
3. 在设置中更新 API Key
4. 重试

### 错误 2: "Insufficient balance"

**原因**: 账户余额不足

**解决方案**:
1. 登录 API 提供商网站
2. 充值账户
3. 重试

### 错误 3: "Invalid video URL"

**原因**: 视频 URL 无法访问或格式不正确

**解决方案**:
1. 使用官方测试视频：
   ```
   https://filesystem.site/cdn/20251030/javYrU4etHVFDqg8by7mViTWHlMOZy.mp4
   ```
2. 确保视频 URL 可公开访问
3. 检查视频格式（支持 mp4）

### 错误 4: "Invalid timestamps"

**原因**: 时间戳格式不正确

**解决方案**:
1. 使用正确的格式：`"开始秒数,结束秒数"`
2. 例如：`"1,3"` 表示 1-3 秒
3. 范围必须在 1-3 秒之间
4. 不要使用小数点

### 错误 5: "Video contains real person"

**原因**: 视频中包含真人

**解决方案**:
1. 使用不包含真人的视频
2. 使用卡通、动画或虚拟角色
3. 使用官方测试视频

### 错误 6: "Rate limit exceeded"

**原因**: 请求频率过高

**解决方案**:
1. 等待几分钟后重试
2. 检查 API 配额限制
3. 升级 API 套餐

## 📝 改进的错误显示

我已经更新了代码，现在会显示更详细的错误信息：

**之前**:
```
Error: [object Object]
```

**现在**:
```
Error: Invalid API Key - 请检查您的 API Key 是否正确
```

或者：
```
Error: Insufficient balance - 账户余额不足，请充值
```

## 🔍 调试技巧

### 1. 查看完整的响应数据

浏览器控制台会显示：
```javascript
[CHARACTER] API Response: {
  status: 500,
  ok: false,
  data: {
    error: {
      message: "具体的错误信息",
      code: "ERROR_CODE",
      type: "invalid_request_error"
    }
  },
  dataString: "格式化的 JSON 字符串"
}
```

### 2. 使用 Network 标签

1. 打开浏览器开发者工具（F12）
2. 切换到 Network 标签
3. 点击"创建角色"
4. 找到 `characters` 请求
5. 查看 Request 和 Response

### 3. 复制为 cURL

1. 在 Network 标签中右键点击请求
2. 选择 "Copy" → "Copy as cURL"
3. 在终端中运行，查看详细响应

## 💡 快速解决方案

### 方案 1: 检查 API Key

1. 打开设置（⚙️）
2. 查看 API Key 是否完整
3. 如果不确定，重新获取并输入

### 方案 2: 使用测试视频

1. 不要上传自己的视频
2. 使用默认的测试视频
3. 时间戳设置为 1-3 秒

### 方案 3: 联系 API 提供商

如果以上都不行：
1. 收集错误信息（浏览器控制台截图）
2. 联系 API 提供商技术支持
3. 提供你的 API Key（前几位和后几位）
4. 描述问题和错误信息

## 📊 错误代码对照表

| 错误代码 | 含义 | 解决方案 |
|---------|------|---------|
| 401 | 未授权 | 检查 API Key |
| 403 | 禁止访问 | 检查权限和配额 |
| 404 | 未找到 | 检查 API 端点 |
| 429 | 请求过多 | 等待后重试 |
| 500 | 服务器错误 | 检查参数或联系支持 |
| 503 | 服务不可用 | 等待服务恢复 |

## 🎯 下一步

1. **刷新页面**
2. **打开浏览器控制台**（F12）
3. **再次尝试创建角色**
4. **查看 `[CHARACTER] API Response` 日志**
5. **找到具体的错误信息**
6. **根据错误信息采取相应措施**

---

**现在错误信息会更清晰，可以帮助你快速定位问题！**
