# è§’è‰²è§†é¢‘ç”Ÿæˆå®Œæ•´æµç¨‹

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### 1. CORS é”™è¯¯
- âœ… ä½¿ç”¨æœåŠ¡å™¨ä»£ç†ï¼Œé¿å…è·¨åŸŸé—®é¢˜
- âœ… æœ¬åœ°å¼€å‘å’Œ Vercel éƒ¨ç½²éƒ½æ—  CORS é—®é¢˜

### 2. ä»»åŠ¡è½®è¯¢ç«¯ç‚¹
- âŒ æ—§ç«¯ç‚¹ï¼š`/api/video/tasks/${taskId}` ï¼ˆå·²åºŸå¼ƒï¼‰
- âœ… æ–°ç«¯ç‚¹ï¼š`/api/videos/${taskId}`

### 3. å“åº”æ ¼å¼å¤„ç†
- âœ… æ”¯æŒ Chat API æ ¼å¼
- âœ… è‡ªåŠ¨æå–ä»»åŠ¡ ID
- âœ… è‡ªåŠ¨æå–è§†é¢‘ URL

## ğŸ¯ å®Œæ•´æµç¨‹

### æ­¥éª¤ 1: åˆ›å»ºè§’è‰²

1. **æ‰“å¼€"è§’è‰²ç®¡ç†"æ ‡ç­¾**
2. **è¾“å…¥è§†é¢‘ URL**ï¼ˆæˆ–ä½¿ç”¨é»˜è®¤ï¼‰
   ```
   https://8416963274f2331f023308de32d91f68.v.smtcdns.com/...
   ```
3. **è®¾ç½®æ—¶é—´æˆ³**ï¼šå¼€å§‹ `1`ï¼Œç»“æŸ `3`
4. **ç‚¹å‡»"åˆ›å»ºè§’è‰²"**
5. **è·å¾—è§’è‰²ä¿¡æ¯**ï¼š
   ```
   ç”¨æˆ·å: @lahdevqrp.skybounddu
   è§’è‰²ID: ch_6925ec91ffb08191b61aae11a98e58dc
   ```

### æ­¥éª¤ 2: ç”Ÿæˆè§’è‰²è§†é¢‘

1. **åˆ‡æ¢åˆ°"è§’è‰²è§†é¢‘ç”Ÿæˆ"æ ‡ç­¾**
2. **è¾“å…¥æç¤ºè¯**ï¼ˆåŒ…å« @usernameï¼‰ï¼š
   ```
   @lahdevqrp.skybounddu è·³ä¸ªèˆ
   ```
3. **é€‰æ‹©å‚æ•°**ï¼š
   - æ¨¡å‹ï¼š`sora_video2`
   - æ—¶é•¿ï¼š`10` ç§’
   - æ–¹å‘ï¼š`portrait`ï¼ˆç«–å±ï¼‰æˆ– `landscape`ï¼ˆæ¨ªå±ï¼‰
4. **ç‚¹å‡»"ç”Ÿæˆè§†é¢‘"**

### æ­¥éª¤ 3: ç­‰å¾…ç”Ÿæˆ

ç³»ç»Ÿä¼šï¼š
1. **åˆ›å»ºä»»åŠ¡**
   - è°ƒç”¨ `/api/video/create-with-character`
   - è¿”å›ä»»åŠ¡ IDï¼ˆå¦‚ `task_xxxxx`ï¼‰

2. **è½®è¯¢çŠ¶æ€**
   - æ¯ 5 ç§’æŸ¥è¯¢ä¸€æ¬¡
   - è°ƒç”¨ `/api/videos/${taskId}`
   - æ˜¾ç¤ºè¿›åº¦å’ŒçŠ¶æ€

3. **å®Œæˆç”Ÿæˆ**
   - çŠ¶æ€å˜ä¸º `completed`
   - æå–è§†é¢‘ URL
   - æ˜¾ç¤ºè§†é¢‘æ’­æ”¾å™¨

## ğŸ“ API æµç¨‹

### åˆ›å»ºè§’è‰²

```
æµè§ˆå™¨ â†’ /api/character/create
         â†“
æœåŠ¡å™¨ â†’ https://apipro.maynor1024.live/sora/v1/characters
         â†“
è¿”å›: { id, username, permalink, profile_picture_url }
```

### ç”Ÿæˆè§’è‰²è§†é¢‘

```
æµè§ˆå™¨ â†’ /api/video/create-with-character
         â†“
æœåŠ¡å™¨ â†’ https://apipro.maynor1024.live/v1/chat/completions
         â†“
è¿”å›: { id: "task_xxx", status: "pending", content: "..." }
```

### æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€

```
æµè§ˆå™¨ â†’ /api/videos/task_xxx
         â†“
æœåŠ¡å™¨ â†’ https://apipro.maynor1024.live/v1/videos/task_xxx
         â†“
è¿”å›: { status: "completed", video_url: "https://..." }
```

## ğŸ”§ å“åº”æ ¼å¼

### Chat API å“åº”ï¼ˆè§’è‰²è§†é¢‘ï¼‰

```json
{
  "id": "foaicmpl-91ef63a3-8251-4d63-bf7c-04b187450a15",
  "object": "chat.completion",
  "created": 1732627233,
  "model": "sora_video2",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "```json\n{\n  \"prompt\": \"@lahdevqrp.skybounddu è·³ä¸ªèˆ\",\n  \"orientation\": \"portrait\"\n}\n```\n\n> ID: `task_01k900ag82ecgbewj2xa3758z0`\n..."
      },
      "finish_reason": "stop"
    }
  ]
}
```

### æå–çš„ä»»åŠ¡ä¿¡æ¯

```javascript
{
  id: "task_01k900ag82ecgbewj2xa3758z0",  // ä» content ä¸­æå–
  status: "pending",
  content: "å®Œæ•´çš„å“åº”å†…å®¹...",
  raw_response: { /* åŸå§‹å“åº” */ }
}
```

### ä»»åŠ¡çŠ¶æ€å“åº”

```json
{
  "id": "task_01k900ag82ecgbewj2xa3758z0",
  "status": "completed",
  "video_url": "https://filesystem.site/cdn/20251126/video.mp4",
  "created_at": 1732627233,
  "completed_at": 1732627293
}
```

## ğŸ’¡ å…³é”®ç‚¹

### 1. ä½¿ç”¨æœåŠ¡å™¨ä»£ç†

**ä¸ºä»€ä¹ˆï¼Ÿ**
- é¿å… CORS é—®é¢˜
- ä¿æŠ¤ API Key
- ç»Ÿä¸€é”™è¯¯å¤„ç†

**å¦‚ä½•é…ç½®ï¼Ÿ**
```env
# .env æ–‡ä»¶
SORA_API_KEY=ä½ çš„API_Key
SORA_BASE_URL=https://apipro.maynor1024.live/
```

### 2. ä»»åŠ¡ ID æ ¼å¼

**Chat API è¿”å›**ï¼š
- Chat completion IDï¼š`foaicmpl-xxx`ï¼ˆä¸èƒ½ç›´æ¥è½®è¯¢ï¼‰
- éœ€è¦ä» `content` ä¸­æå–çœŸæ­£çš„ä»»åŠ¡ IDï¼š`task_xxx`

**æå–é€»è¾‘**ï¼š
```javascript
const taskIdMatch = content.match(/task_[a-z0-9]+/i);
if (taskIdMatch) {
  const taskId = taskIdMatch[0]; // task_xxx
}
```

### 3. è½®è¯¢ç«¯ç‚¹

**æ­£ç¡®çš„ç«¯ç‚¹**ï¼š
```
GET /api/videos/{taskId}
```

**ä¸è¦ä½¿ç”¨**ï¼š
```
GET /api/video/tasks/{taskId}  // å·²åºŸå¼ƒ
```

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1: CORS é”™è¯¯

**ç—‡çŠ¶**ï¼š
```
Access to fetch at 'https://...' has been blocked by CORS policy
```

**è§£å†³**ï¼š
- âœ… å·²ä¿®å¤ï¼šä½¿ç”¨æœåŠ¡å™¨ä»£ç†
- é‡å¯æœåŠ¡å™¨ï¼š`npm start`

### é—®é¢˜ 2: 410 Gone é”™è¯¯

**ç—‡çŠ¶**ï¼š
```
GET /api/video/tasks/xxx 410 (Gone)
Task polling is no longer supported
```

**è§£å†³**ï¼š
- âœ… å·²ä¿®å¤ï¼šä½¿ç”¨æ–°ç«¯ç‚¹ `/api/videos/${taskId}`
- åˆ·æ–°é¡µé¢

### é—®é¢˜ 3: ä»»åŠ¡ ID æå–å¤±è´¥

**ç—‡çŠ¶**ï¼š
```
Could not extract task ID from response
```

**åŸå› **ï¼š
- Chat API å“åº”æ ¼å¼ä¸åŒ
- å†…å®¹ä¸­æ²¡æœ‰ `task_xxx` æ ¼å¼çš„ ID

**è§£å†³**ï¼š
- æ£€æŸ¥å“åº”å†…å®¹
- å¯èƒ½éœ€è¦ç­‰å¾…æˆ–é‡è¯•

### é—®é¢˜ 4: è§†é¢‘ URL æœªæ‰¾åˆ°

**ç—‡çŠ¶**ï¼š
```
è§†é¢‘URLæœªæ‰¾åˆ°ï¼Œè¯·æ£€æŸ¥ä»»åŠ¡è¯¦æƒ…
```

**åŸå› **ï¼š
- ä»»åŠ¡å®Œæˆä½†å“åº”æ ¼å¼ä¸ç¬¦åˆé¢„æœŸ
- API è¿”å›çš„å­—æ®µåä¸åŒ

**è§£å†³**ï¼š
- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„å®Œæ•´å“åº”
- å¯èƒ½éœ€è¦æ›´æ–°å­—æ®µæ˜ å°„

## ğŸ¬ ç¤ºä¾‹æç¤ºè¯

### åŸºç¡€åŠ¨ä½œ

```
@lahdevqrp.skybounddu è·³ä¸ªèˆ
@lahdevqrp.skybounddu æŒ¥æ‰‹æ‰“æ‹›å‘¼
@lahdevqrp.skybounddu è½¬åœˆ
```

### åœºæ™¯æè¿°

```
@lahdevqrp.skybounddu åœ¨æ£®æ—é‡Œå¥”è·‘
@lahdevqrp.skybounddu åœ¨æµ·è¾¹æ•£æ­¥
@lahdevqrp.skybounddu åœ¨é›ªåœ°é‡Œç©è€
```

### æƒ…æ„Ÿè¡¨è¾¾

```
@lahdevqrp.skybounddu å¼€å¿ƒåœ°ç¬‘
@lahdevqrp.skybounddu æƒŠè®¶åœ°çœ‹ç€é•œå¤´
@lahdevqrp.skybounddu æ€è€ƒçš„æ ·å­
```

## ğŸ“Š æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | é¢„è®¡æ—¶é—´ |
|------|---------|
| åˆ›å»ºè§’è‰² | 5-10 ç§’ |
| æäº¤è§†é¢‘ä»»åŠ¡ | 1-2 ç§’ |
| è§†é¢‘ç”Ÿæˆ | 1-3 åˆ†é’Ÿ |
| æ€»è®¡ | çº¦ 2-4 åˆ†é’Ÿ |

## ğŸš€ ä¼˜åŒ–å»ºè®®

### 1. ä½¿ç”¨ç¼“å­˜

- åˆ›å»ºçš„è§’è‰²ä¼šä¿å­˜åœ¨æœ¬åœ°
- æ— éœ€é‡å¤åˆ›å»ºç›¸åŒè§’è‰²

### 2. æ‰¹é‡ç”Ÿæˆ

- å¯ä»¥åŒæ—¶åˆ›å»ºå¤šä¸ªè§’è‰²
- å¯ä»¥ä¸ºåŒä¸€è§’è‰²ç”Ÿæˆå¤šä¸ªè§†é¢‘

### 3. æç¤ºè¯ä¼˜åŒ–

- ä½¿ç”¨æ¸…æ™°ç®€æ´çš„æè¿°
- é¿å…è¿‡äºå¤æ‚çš„åœºæ™¯
- ä¸€æ¬¡åªæè¿°ä¸€ä¸ªä¸»è¦åŠ¨ä½œ

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°**ï¼ˆF12ï¼‰
   - æŸ¥æ‰¾ `[CHARACTER]` å¼€å¤´çš„æ—¥å¿—
   - æŸ¥çœ‹å®Œæ•´çš„è¯·æ±‚å’Œå“åº”

2. **æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—**
   - æŸ¥æ‰¾ `[Server]` å’Œ `[Sora2]` å¼€å¤´çš„æ—¥å¿—
   - æŸ¥çœ‹ API è°ƒç”¨è¯¦æƒ…

3. **æ£€æŸ¥é…ç½®**
   - `.env` æ–‡ä»¶ä¸­çš„ API Key å’Œ Base URL
   - å‰ç«¯è®¾ç½®ä¸­çš„è‡ªå®šä¹‰é…ç½®

---

**ç°åœ¨è§’è‰²è§†é¢‘ç”Ÿæˆæµç¨‹å·²ç»å®Œæ•´ä¿®å¤ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ï¼** ğŸ‰
