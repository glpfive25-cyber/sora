# 错误提示优化说明

## 问题描述

用户在图生视频时遇到错误"当前不支持上传包含写实人物的图像"，但前端没有显示任何错误提示，用户不知道发生了什么。

## 根本原因

1. 图生视频功能使用的是 `showError()` 函数，但该函数是为普通视频生成设计的，操作的是 `videoContainer`
2. 图生视频使用的是 `imageVideoContainer`，所以错误信息没有显示在正确的位置
3. 缺少针对图生视频的专用错误显示函数

## 修复内容

### 1. 新增图生视频错误显示函数

```javascript
// 显示图生视频错误
function showImageVideoError(message, suggestions = '') {
    const imageVideoContainer = document.getElementById('imageVideoContainer');
    const imageVideoPlayer = document.getElementById('imageVideoPlayer');
    
    // Clear progress tracking
    if (imageVideoProgressInterval) {
        clearInterval(imageVideoProgressInterval);
        imageVideoProgressInterval = null;
    }
    imageVideoStartTime = null;
    
    hideImageVideoProgressIndicator();
    
    if (imageVideoPlayer) imageVideoPlayer.classList.add('hidden');
    if (imageVideoContainer) {
        imageVideoContainer.classList.remove('hidden');
        imageVideoContainer.innerHTML = `
            <div class="text-center max-w-2xl mx-auto p-8">
                <div class="text-6xl mb-4">❌</div>
                <h3 class="text-lg font-semibold text-red-600 mb-2">${message}</h3>
                ${suggestions ? `<div class="text-gray-700 mt-4 text-sm">${suggestions}</div>` : ''}
                <button onclick="resetImageVideoDisplay()" class="mt-6 px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:opacity-90 transition shadow-lg">
                    <i class="fas fa-redo mr-2"></i>重新尝试
                </button>
            </div>
        `;
    }
}
```

### 2. 新增重置显示函数

```javascript
// 重置图生视频显示
function resetImageVideoDisplay() {
    const imageVideoContainer = document.getElementById('imageVideoContainer');
    if (imageVideoContainer) {
        imageVideoContainer.innerHTML = `
            <div class="text-center">
                <div class="text-6xl mb-4">🎬</div>
                <h3 class="text-lg font-semibold text-gray-800 mb-2">上传图片并输入提示词</h3>
                <p class="text-sm text-gray-600">生成的视频将在这里显示</p>
            </div>
        `;
    }
}
```

### 3. 优化图生视频错误处理

```javascript
catch (error) {
    console.error('[Image to Video] Error:', error);
    hideImageVideoProgressIndicator();
    
    // 根据错误类型显示不同的提示
    let errorMessage = '视频生成失败';
    let suggestions = '';
    
    if (error.message.includes('写实人物') || error.message.includes('真人')) {
        errorMessage = '❌ 图片审核未通过';
        suggestions = `
            <div class="text-left">
                <p class="font-semibold mb-2">原因：</p>
                <p class="mb-3">${error.message}</p>
                <p class="font-semibold mb-2">💡 建议：</p>
                <ul class="list-disc list-inside space-y-1">
                    <li>使用卡通、动漫风格的图片</li>
                    <li>使用风景、物品等非人物图片</li>
                    <li>避免使用真人照片或写实人物图片</li>
                </ul>
            </div>
        `;
    } else if (error.message.includes('503')) {
        errorMessage = '⚠️ API 服务暂时不可用';
        suggestions = '请稍后重试，或检查API配置';
    } else if (error.message.includes('timeout') || error.message.includes('超时')) {
        errorMessage = '⏱️ 请求超时';
        suggestions = '视频生成时间较长，请稍后重试';
    } else {
        errorMessage = '❌ 视频生成失败';
        suggestions = error.message || '请重试';
    }
    
    showImageVideoError(errorMessage, suggestions);
}
```

### 4. 优化普通视频生成错误处理

添加了对"写实人物"错误的特殊处理：

```javascript
if (error.message.includes('写实人物') || error.message.includes('真人')) {
    errorMessage = '❌ 内容审核未通过';
    suggestions = `
        <div class="mt-3 text-left text-sm">
            <p class="font-semibold mb-2">原因：</p>
            <p class="mb-3">${error.message}</p>
            <p class="font-semibold mb-2">💡 建议：</p>
            <ul class="list-disc list-inside space-y-1">
                <li>避免使用真人照片或写实人物图片</li>
                <li>使用卡通、动漫风格的图片</li>
                <li>使用风景、物品等非人物内容</li>
                <li>修改提示词，避免涉及真人或名人</li>
            </ul>
        </div>
    `;
}
```

## 错误类型处理

### 1. 写实人物错误
**错误信息**：`当前不支持上传包含写实人物的图像`

**显示效果**：
```
❌ 图片审核未通过

原因：
当前不支持上传包含写实人物的图像

💡 建议：
• 使用卡通、动漫风格的图片
• 使用风景、物品等非人物图片
• 避免使用真人照片或写实人物图片

[重新尝试]
```

### 2. API服务不可用
**错误信息**：包含 `503`

**显示效果**：
```
⚠️ API 服务暂时不可用

请稍后重试，或检查API配置

[重新尝试]
```

### 3. 请求超时
**错误信息**：包含 `timeout` 或 `超时`

**显示效果**：
```
⏱️ 请求超时

视频生成时间较长，请稍后重试

[重新尝试]
```

### 4. 其他错误
**显示效果**：
```
❌ 视频生成失败

[具体错误信息]

[重新尝试]
```

## 用户体验改进

### 修复前
- ❌ 错误只在控制台显示
- ❌ 用户看不到任何提示
- ❌ 不知道发生了什么
- ❌ 不知道如何解决

### 修复后
- ✅ 错误在界面上清晰显示
- ✅ 提供具体的错误原因
- ✅ 给出解决建议
- ✅ 提供"重新尝试"按钮

## 错误显示位置

### 普通视频生成
- 容器：`videoContainer`
- 函数：`showError()`

### 图生视频
- 容器：`imageVideoContainer`
- 函数：`showImageVideoError()`

## 测试建议

### 1. 测试写实人物错误
1. 上传一张真人照片
2. 点击"生成视频"
3. 验证错误提示正确显示
4. 验证建议内容清晰

### 2. 测试其他错误
1. 测试503错误（API不可用）
2. 测试超时错误
3. 测试网络错误
4. 验证所有错误都有友好提示

### 3. 测试重新尝试
1. 点击"重新尝试"按钮
2. 验证界面重置正确
3. 验证可以重新上传图片

## 常见错误及建议

### 写实人物错误
**原因**：API审核机制，不允许使用真人或写实人物图片

**建议**：
- ✅ 使用卡通、动漫风格图片
- ✅ 使用风景、物品图片
- ✅ 使用抽象、艺术风格图片
- ❌ 避免真人照片
- ❌ 避免写实人物画像

### API配置错误
**原因**：API Key无效或未配置

**建议**：
- 检查前端设置页面的API配置
- 确认API Key正确且有效
- 检查Base URL是否正确

### 超时错误
**原因**：视频生成时间过长

**建议**：
- 使用较短的视频时长（10秒）
- 简化提示词
- 使用较小的图片
- 稍后重试

## 总结

- ✅ **新增专用错误显示函数**：`showImageVideoError()`
- ✅ **智能错误识别**：根据错误类型显示不同提示
- ✅ **友好的错误信息**：清晰的原因和建议
- ✅ **便捷的重试功能**：一键重置并重试
- ✅ **完整的错误覆盖**：处理所有常见错误类型
- ✅ **用户体验优化**：从"不知道发生了什么"到"知道原因和解决方法"
